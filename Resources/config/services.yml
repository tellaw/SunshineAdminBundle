services:
  sunshine.crud_service:
    class: Tellaw\SunshineAdminBundle\Service\CrudService
    arguments: ["@doctrine.orm.entity_manager", "@sunshine.entities", "@service_container"]

  sunshine.menu:
    class: Tellaw\SunshineAdminBundle\Service\MenuService
    arguments: ["%tellaw_sunshine_admin.menu%", "%tellaw_sunshine_admin.entities%"]

  sunshine.pages:
    class: Tellaw\SunshineAdminBundle\Service\PageService
    arguments: ["%tellaw_sunshine_admin.pages%"]

  sunshine.entities:
    class: Tellaw\SunshineAdminBundle\Service\EntityService
    arguments: ["%tellaw_sunshine_admin.entities%"]

  sunshine.widgets:
    class: Tellaw\SunshineAdminBundle\Service\WidgetService
    arguments: [ '@router' ]
    scope: request_stack

  sunshine.widget_twig_extension:
    class: Tellaw\SunshineAdminBundle\Twig\WidgetExtension
    arguments: ["%tellaw_sunshine_admin.pages%", "@sunshine.widgets"]
    tags:
      - { name: twig.extension }

  sunshine.collection_twig_extension:
    class: Tellaw\SunshineAdminBundle\Twig\CollectionExtension
    tags:
      - { name: twig.extension }

  sunshine.embeddedType:
    class: Tellaw\SunshineAdminBundle\Form\Type\EmbeddedType
    arguments: ["@sunshine.crud_service"]

  sunshine.menu_twig_extension:
    class: Tellaw\SunshineAdminBundle\Twig\MenuExtension
    arguments: ["@security.authorization_checker"]
    tags:
      - { name: twig.extension }

  sunshine.default_form_type:
    class: Tellaw\SunshineAdminBundle\Form\Type\DefaultType
    arguments: ['@sunshine.crud_service', "@doctrine.orm.entity_manager" ]
    tags:
      - { name: form.type }

  sunshine.filtersType:
    class: Tellaw\SunshineAdminBundle\Form\Type\FiltersType
    arguments: ['@sunshine.crud_service', "@doctrine.orm.entity_manager" ]
    tags:
      - { name: form.type }

  ##
  ## WIDGETS DEFINITION
  ##
  sunshine.widgets.abstract:
    abstract:  true
    arguments: [ '@request_stack', '@twig', "@doctrine.orm.entity_manager" ]
    scope: request_stack

  sunshine.widgets.edit:
    class: Tellaw\SunshineAdminBundle\Service\Widgets\EditWidget
    parent: sunshine.widgets.abstract
    tags:
      - {name: sunshine.widget }

  sunshine.widgets.view:
    class: Tellaw\SunshineAdminBundle\Service\Widgets\ViewWidget
    parent: sunshine.widgets.abstract
    calls:
      - [ setEntities, ['@sunshine.entities']]
      - [ setCrudService, ['@sunshine.crud_service']]
    tags:
      - {name: sunshine.widget }

  sunshine.widgets.list:
    class: Tellaw\SunshineAdminBundle\Service\Widgets\ListWidget
    parent: sunshine.widgets.abstract
    calls:
      - [ setEntities, ['@sunshine.entities']]
      - [ setCrudService, ['@sunshine.crud_service']]
    tags:
      - {name: sunshine.widget }

  sunshine.theme_twig_extension:
    class: Tellaw\SunshineAdminBundle\Twig\ThemeExtension
    arguments: ["%tellaw_sunshine_admin.theme%"]
    tags:
      - { name: twig.extension }
